<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Location Map</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <style>
        /* กำหนดให้ทุกอย่างชิดขอบและเต็มหน้าจอ */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        /* กำหนดให้แผนที่เต็มพื้นที่ของ body */
        #map {
            height: 100%;
            width: 100%;
            /* ทำให้แผนที่ดูนุ่มนวลขึ้น (ทางเลือก) */
            /* filter: grayscale(50%) contrast(1.2) brightness(1.1); */
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
        // 2. ตั้งค่าแผนที่เริ่มต้น
        // ใช้พิกัดใจกลางโลกและซูมออกมาไกลๆ เพื่อความรู้สึกแบบ Global
        const map = L.map('map', {
            zoomControl: false // ซ่อนปุ่ม +/- สำหรับซูม
        }).setView([20, 0], 2);

        // เพิ่มปุ่มซูมในตำแหน่งที่เรียบง่ายกว่า (ขวาบน)
        L.control.zoom({ position: 'topright' }).addTo(map);

        // 3. ใช้ Tile Layer แบบมินิมอลจาก CartoDB
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // 4. ฟังก์ชันเมื่อหาตำแหน่งสำเร็จ
        function onLocationFound(e) {
            const radius = e.accuracy / 2;
            
            // ใช้ flyTo เพื่อให้เกิดแอนิเมชันการเคลื่อนที่ที่นุ่มนวล
            map.flyTo(e.latlng, 16, {
                animate: true,
                duration: 1.5 // ระยะเวลาแอนิเมชัน (วินาที)
            });

            // เพิ่ม Marker ที่ตำแหน่งของผู้ใช้
            L.marker(e.latlng).addTo(map)
                .bindPopup("<b>คุณอยู่ที่นี่</b>").openPopup();
        }

        // ฟังก์ชันเมื่อหาตำแหน่งไม่สำเร็จ
        function onLocationError(e) {
            // ไม่ต้องแสดงกล่องข้อความ แต่จะแจ้งใน Console ของเบราว์เซอร์แทน
            console.warn(`ไม่สามารถระบุตำแหน่งได้: ${e.message}`);
            alert("ไม่สามารถเข้าถึงตำแหน่งของคุณได้ โปรดตรวจสอบการตั้งค่าเบราว์เซอร์");
        }

        // 5. สั่งให้แผนที่ค้นหาตำแหน่ง
        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        // เริ่มกระบวนการค้นหาตำแหน่ง
        map.locate({setView: false, maxZoom: 16, watch: false}); // setView: false เพื่อให้เราควบคุมแอนิเมชันเองผ่าน flyTo

    </script>

</body>
</html>

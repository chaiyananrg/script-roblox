<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ตำแหน่งของคุณบนแผนที่</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

    <style>
        /* กำหนดสไตล์ให้แผนที่แสดงเต็มหน้าจอ */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        /* กล่องข้อความแจ้งเตือน */
        #status {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000; /* ให้แสดงอยู่เหนือแผนที่ */
            background-color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            display: none; /* ซ่อนไว้ก่อน */
        }
    </style>
</head>
<body>

    <div id="status">กำลังค้นหาตำแหน่งของคุณ...</div>
    <div id="map"></div>

    <script>
        // 3. เริ่มต้นเขียนโค้ด JavaScript
        const mapElement = document.getElementById('map');
        const statusElement = document.getElementById('status');

        // แสดงข้อความแจ้งเตือน
        function showStatus(message) {
            statusElement.textContent = message;
            statusElement.style.display = 'block';
        }

        // ---------- การตั้งค่าแผนที่เริ่มต้น ----------
        // ตั้งค่ามุมมองเริ่มต้นของแผนที่ (เราจะตั้งไว้ที่กรุงเทพฯ ก่อน)
        // และกำหนดค่าซูมเริ่มต้นให้เห็นภาพรวมประเทศไทย
        const map = L.map('map').setView([13.7563, 100.5018], 6);

        // เพิ่ม Layer ของแผนที่จาก OpenStreetMap (ไม่ต้องใช้ API Key)
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // ---------- การขอตำแหน่งผู้ใช้ (Geolocation API) ----------

        // ตรวจสอบว่าเบราว์เซอร์รองรับ Geolocation หรือไม่
        if ('geolocation' in navigator) {
            showStatus('กำลังขออนุญาตเข้าถึงตำแหน่ง...');

            // ขอตำแหน่งปัจจุบันของผู้ใช้
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // --- กรณีสำเร็จ ---
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    showStatus('พบตำแหน่งของคุณแล้ว!');
                    setTimeout(() => { statusElement.style.display = 'none'; }, 3000); // ซ่อนข้อความหลังจาก 3 วินาที

                    // ย้ายจุดศูนย์กลางแผนที่ไปยังตำแหน่งของผู้ใช้ และซูมเข้าไปใกล้ขึ้น
                    map.setView([lat, lon], 16);

                    // เพิ่มหมุด (Marker) ณ ตำแหน่งนั้น
                    const marker = L.marker([lat, lon]).addTo(map)
                        .bindPopup(`<b>คุณอยู่ที่นี่!</b><br>ละติจูด: ${lat.toFixed(4)}<br>ลองจิจูด: ${lon.toFixed(4)}`)
                        .openPopup();

                    // (ทางเลือก) เพิ่มวงกลมเพื่อแสดงรัศมีความคลาดเคลื่อน (Accuracy)
                    const circle = L.circle([lat, lon], {
                        radius: accuracy,
                        color: '#1d9bf0',
                        fillColor: '#1d9bf0',
                        fillOpacity: 0.2
                    }).addTo(map);

                },
                (error) => {
                    // --- กรณีเกิดข้อผิดพลาด ---
                    let errorMessage = 'เกิดข้อผิดพลาดที่ไม่รู้จัก';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = 'คุณปฏิเสธการเข้าถึงตำแหน่ง';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = 'ไม่สามารถระบุตำแหน่งปัจจุบันได้';
                            break;
                        case error.TIMEOUT:
                            errorMessage = 'หมดเวลาในการร้องขอตำแหน่ง';
                            break;
                    }
                    showStatus(errorMessage);
                    console.error("Geolocation Error:", errorMessage);
                }
            );

        } else {
            // กรณีเบราว์เซอร์ไม่รองรับ
            showStatus('เบราว์เซอร์ของคุณไม่รองรับการเข้าถึงตำแหน่ง');
            console.error("Geolocation is not supported by this browser.");
        }
    </script>

</body>
</html>
